/*
Modified base on:
http://bl.ocks.org/mbostock/3719724
*/

<!DOCTYPE html>
<meta charset="utf-8">
<style type="text/css">

table {
  border-collapse: collapse;
  font: 10px sans-serif;
  width: 720px;
}

th {
  font-weight: normal;
  text-align: right;
  padding-right: 6px;
  min-width: 43px;
}

thead td {
  cursor: s-resize;
}

tbody tr:first-child td {
  padding-top: 2px;
}

tbody td {
  padding: 0;
  border-left: solid 1px #000;
}

tbody rect {
  fill: steelblue;
}

tbody text {
  -webkit-text-stroke: 1px white;
  color: black;
  font-size: 10px;
  text-align: left;
}
tbody tr:hover rect {
  fill: brown;
}

</style>

<table>
  <thead>
    <tr>
      <th>Nation</th>
      <td>TAX</td>
      <td>ADMINISTRATION</td>
      <td>DEFENCE</td>
      <td>EDUCATION</td>
      <td>ENVIRONMENT</td>
      <td>HEALTHCARE</td>
      <td>COMMERCE</td>
      <td>INTERNATIONAL AID</td>
      <td>LAW AND ORDER</td>
      <td>PUBLIC TRANSPORT</td>
      <td>SOCIAL EQUALITY</td>
      <td>SPIRITUALITY</td>
      <td>WELFARE</td>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script>

d3.csv("nation-edited-numberic.csv", function(error, states) {
  if (error) throw error;
  var sortOrder = false;

  var ages = d3.keys(states[0]).filter(function(key) {
    console.log("key:"+key);
    return key != "NAME" && key != "POPULATION";
  });

  d3.selectAll("thead td").data(ages).on("click", function(k) {
    //Flip value of sortOrder
		sortOrder = !sortOrder;
    tr.sort(function(a, b) {
      if(sortOrder){
        return b[k] - a[k];
      }else {
        return a[k] - b[k];
      }
       });
  });

  var tr = d3.select("tbody").selectAll("tr")
      .data(states)
    .enter().append("tr")
    .on("click",clicked);

  tr.append("th")
      .text(function(d) { return d.NAME; });

  var bar = tr.selectAll("td")
      .data(function(d) { return ages.map(function(k) { return d[k]; }); })
    .enter().append("td").append("svg")
      .attr("width", 100)
      .attr("height", 20);

  bar.append("rect")
      .attr('id','bars')
      .attr("height", 20)
      .attr("width", function(d) { return d; });

  bar.append("text")
    .attr("x", function(d){return 15;})
    .attr("y", 10)
    .attr("dy", ".35em")
    .text(function(d){return d;});

});

function clicked(d){
  console.log("d: "+d+"d.fill: "+d.fill);
  d.selectAll("td").attr("fill", "yellow");
}

</script>
